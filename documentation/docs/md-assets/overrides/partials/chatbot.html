<style>
#chat-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 320px;
  background: #fff;
  border-radius: 12px;
  border: 1px solid #ddd;
  padding: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  font-family: sans-serif;
  z-index: 1000;
}
#chat-log {
  height: 200px;
  overflow-y: auto;
  margin-bottom: 10px;
  border: 1px solid #eee;
  border-radius: 4px;
  padding: 8px;
  background: #f9f9f9;
}
#chat-input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}
</style>

<div id="chat-widget">
  <div id="chat-log"></div>
  <input id="chat-input" placeholder="Ask a question..." autocomplete="off" />
</div>

<!-- Chatbot script loaded via `extra_javascript` in mkdocs.yml -->
<script>
  // Bootstrap loader: ensure chatbot.js is loaded even with client-side navigation
  (function(){
    if (window.__chatbot_loader_installed) return; window.__chatbot_loader_installed = true;
    function loadScript(src){
      if (document.querySelector('script[src="'+src+'"]')) return;
      var s = document.createElement('script'); s.src = src; s.async = false; s.defer = false;
      document.head.appendChild(s);
    }
    function getSiteRoot(){
      var el = document.querySelector('link[rel="canonical"]');
      if (!el || !el.href) return '';
      try {
        var url = new URL(el.href);
        var path = url.pathname;
        // Extract base: if canonical is /sample-doc-site/ or /sample-doc-site/some/page/, 
        // we want /sample-doc-site/
        var match = path.match(/^(\/[^\/]+\/)/);
        return match ? match[1] : '/';
      } catch(e) { return ''; }
    }
    function ensure(){
      var root = getSiteRoot();
      var src = root + 'md-assets/js/chatbot.js';
      loadScript(src);
    }
    // Load immediately and on navigation events
    ensure();
    document.addEventListener('navigation', ensure);
  })();
</script>